% --- Part 3: V(t) Staircase Voltage Profile ---
clear; clc; close all;

%% 1. Define Constants
% Time constant
t_step_s = 2.5e-5;    % 25 us, time per step (equal to t_cap)
t_step_mus = t_step_s * 1e6; % 25 us

% Voltage constant
delta_V = -73.75;   % Voltage step per dot (V)

% Line definition
num_dots_below = 10;
num_dots_above = 10;
total_dots = num_dots_below + num_dots_above + 1;

%% 2. Generate Time and Voltage Vectors
% Create a vector of the dot indices, e.g., -10, -9, ..., 0, ..., 9, 10
dot_indices = (-num_dots_below:num_dots_above); % This has 21 values

% Calculate the voltage level for each dot
V_levels = dot_indices * delta_V; % 21 corresponding voltage levels

% Create the time vector (in microseconds) for the *start* of each step
% This will have 21 time points: 0, 25, 50, ..., 500
t_start_mus = (0:(total_dots-1)) * t_step_mus;

%% 3. Plot the Staircase
figure;
% stairs(X,Y) plots Y(i) from X(i) to X(i+1)
% This is the most direct way to plot it in MATLAB.
stairs(t_start_mus, V_levels, 'b-', 'LineWidth', 2);

% Set axis limits to show the full duration of the last step
xlim([0, total_dots * t_step_mus]);

% Formatting
title("Staircase Voltage Profile V(t) for Drawing 'I'", 'FontSize', 14);
xlabel("Time ($t$) [$\mu s$]", 'FontSize', 12);
ylabel("Applied Voltage ($V$) [Volts]", 'FontSize', 12);
grid on;

% Add annotations for clarity
text(50, 800, sprintf('V for lowest dot (n=-10)\n= %.2f V', V_levels(1)), 'HorizontalAlignment', 'left');
text(250, 0, sprintf('V for center dot (n=0)\n= %.2f V', V_levels(11)), 'HorizontalAlignment', 'center');
text(450, -800, sprintf('V for highest dot (n=10)\n= %.2f V', V_levels(end)), 'HorizontalAlignment', 'right');

% Save the figure
saveas(gcf, 'voltage_staircase_profile.png');
fprintf('Staircase plot saved as voltage_staircase_profile.png\n');
